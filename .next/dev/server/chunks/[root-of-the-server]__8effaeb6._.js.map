{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 100, "column": 0}, "map": {"version":3,"sources":["file:///Users/santimundifalgueras/AI%20Agents/Future_Banking/v0-bank-of-the-future/lib/supabase/server.ts"],"sourcesContent":["import { createServerClient } from \"@supabase/ssr\"\nimport { cookies } from \"next/headers\"\n\nexport async function createClient() {\n  const cookieStore = await cookies()\n\n  return createServerClient(\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\n    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,\n    {\n      cookies: {\n        getAll() {\n          return cookieStore.getAll()\n        },\n        setAll(cookiesToSet) {\n          try {\n            cookiesToSet.forEach(({ name, value, options }) => cookieStore.set(name, value, options))\n          } catch {\n            // The `setAll` method was called from a Server Component.\n            // This can be ignored if you have middleware refreshing sessions.\n          }\n        },\n      },\n    },\n  )\n}\n"],"names":[],"mappings":";;;;AAAA;AAAA;AACA;;;AAEO,eAAe;IACpB,MAAM,cAAc,MAAM,IAAA,iNAAO;IAEjC,OAAO,IAAA,sQAAkB,sUAGvB;QACE,SAAS;YACP;gBACE,OAAO,YAAY,MAAM;YAC3B;YACA,QAAO,YAAY;gBACjB,IAAI;oBACF,aAAa,OAAO,CAAC,CAAC,EAAE,IAAI,EAAE,KAAK,EAAE,OAAO,EAAE,GAAK,YAAY,GAAG,CAAC,MAAM,OAAO;gBAClF,EAAE,OAAM;gBACN,0DAA0D;gBAC1D,kEAAkE;gBACpE;YACF;QACF;IACF;AAEJ"}},
    {"offset": {"line": 131, "column": 0}, "map": {"version":3,"sources":["file:///Users/santimundifalgueras/AI%20Agents/Future_Banking/v0-bank-of-the-future/app/api/chat/route.ts"],"sourcesContent":["import { OpenAI } from \"openai\"\nimport { OpenAIStream, StreamingTextResponse } from \"ai\"\nimport { createClient } from \"@/lib/supabase/server\"\n\n// Set the runtime to nodejs for better compatibility\nexport const runtime = \"nodejs\"\n\nexport async function POST(req: Request) {\n  try {\n    const { messages, userId: requestedUserId } = await req.json()\n\n    // Initialize OpenAI client\n    if (!process.env.OPENAI_API_KEY) {\n      console.error(\"Missing OPENAI_API_KEY\")\n      return new Response(\"Missing OPENAI_API_KEY\", { status: 500 })\n    }\n\n    const openai = new OpenAI({\n      apiKey: process.env.OPENAI_API_KEY,\n    })\n\n    // Get the current user\n    const supabase = await createClient()\n    \n    // Determine userId:\n    // 1. Try auth (if logged in)\n    // 2. Use requestedUserId (from client, e.g. role switcher)\n    // 3. Fallback to demo default\n    \n    let userId = \"11111111-1111-1111-1111-111111111111\" // Default to Sarah Chen for demo\n    \n    const {\n      data: { user },\n    } = await supabase.auth.getUser()\n\n    if (user) {\n      userId = user.id\n    } else if (requestedUserId) {\n        userId = requestedUserId\n    }\n\n    // Fetch user's financial data for context\n    const [accounts, cards, loans, transactions, holdings, goals, rewardProfile, rewardActivities] = await Promise.all([\n      supabase.from(\"accounts\").select(\"*\").eq(\"user_id\", userId),\n      supabase.from(\"cards\").select(\"*\").eq(\"user_id\", userId),\n      supabase.from(\"loans\").select(\"*\").eq(\"user_id\", userId),\n      supabase.from(\"transactions\").select(\"*\").eq(\"user_id\", userId).order(\"date\", { ascending: false }).limit(10),\n      supabase.from(\"portfolio_holdings\").select(\"*\").eq(\"user_id\", userId),\n      supabase.from(\"savings_goals\").select(\"*\").eq(\"user_id\", userId),\n      supabase.from(\"reward_profiles\").select(\"*\").eq(\"user_id\", userId).single(),\n      supabase.from(\"reward_activities\").select(\"*\").eq(\"user_id\", userId).order(\"created_at\", { ascending: false }).limit(5),\n    ])\n\n    // Construct the system prompt with context\n    const systemPrompt = `\n  You are an AI Banker Assistant for \"Bank of the Future\". You have access to the user's financial data.\n  Your goal is to provide helpful, accurate, and concise financial advice and answer questions about their accounts.\n\n  User Context:\n  - ID: ${userId}\n\n  Financial Data:\n  1. ACCOUNTS:\n  ${JSON.stringify(accounts.data, null, 2)}\n\n  2. CARDS:\n  ${JSON.stringify(cards.data, null, 2)}\n\n  3. LOANS:\n  ${JSON.stringify(loans.data, null, 2)}\n\n  4. RECENT TRANSACTIONS (Last 10):\n  ${JSON.stringify(transactions.data, null, 2)}\n\n  5. INVESTMENT PORTFOLIO:\n  ${JSON.stringify(holdings.data, null, 2)}\n\n  6. SAVINGS GOALS:\n  ${JSON.stringify(goals.data, null, 2)}\n  \n  7. REWARDS & POINTS:\n  - Profile: ${JSON.stringify(rewardProfile.data, null, 2)}\n  - Recent Activity: ${JSON.stringify(rewardActivities.data, null, 2)}\n\n  Guidelines:\n  - Be professional yet friendly.\n  - Use the provided data to answer questions specifically. e.g., \"Your current balance in your Primary Account is AED 45,000\".\n  - If the user asks about something not in the data, explain that you don't have that information.\n  - Do NOT make up transaction data that isn't there.\n  - Format currency appropriately (e.g., AED 1,000.00).\n  - If the user asks to perform an action (like transfer money), guide them on how to do it or say \"I can help you prepare a transfer\" (in a real app you'd call a function).\n  - Keep responses concise.\n  \n   Formatting Guidelines:\n  - Use Markdown for formatting.\n  - Do NOT use double asterisks (**) for bolding headers or lists if it clutters the view. Instead, use clean spacing and indentation.\n  - For lists of items (like transactions or portfolio holdings), follow this clean format:\n  \n    1. Item Name\n       - Detail: Value\n       - Detail: Value\n  \n  - Avoid excessive bolding within sentences. Use it only for key figures if absolutely necessary.\n  `\n\n    // Request the OpenAI API for the response based on the prompt\n    const response = await openai.chat.completions.create({\n      model: \"gpt-4o\",\n      stream: true,\n      messages: [\n        { role: \"system\", content: systemPrompt },\n        ...messages,\n      ],\n    })\n\n    // Convert the response into a friendly text-stream\n    const stream = OpenAIStream(response as any)\n\n    // Respond with the stream\n    return new StreamingTextResponse(stream)\n  } catch (error) {\n    console.error(\"Error in chat route:\", error)\n    return new Response(error instanceof Error ? error.message : \"Internal Server Error\", { status: 500 })\n  }\n}\n"],"names":[],"mappings":"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"}}]
}